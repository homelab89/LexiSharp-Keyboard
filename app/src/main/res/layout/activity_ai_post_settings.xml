<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
  xmlns:app="http://schemas.android.com/apk/res-auto"
  android:layout_width="match_parent"
  android:layout_height="match_parent"
  android:orientation="vertical">

  <com.google.android.material.appbar.MaterialToolbar
    android:id="@+id/toolbar"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:titleCentered="true"
    app:title="@string/title_ai_settings" />

  <androidx.core.widget.NestedScrollView
    android:layout_width="match_parent"
    android:layout_height="0dp"
    android:layout_weight="1"
    android:fillViewport="true">

    <LinearLayout
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:padding="16dp"
      android:orientation="vertical">

      <!-- Group 1: 后处理模式 (合并 AI 编辑默认范围 + 跳过阈值) -->
      <LinearLayout
        style="@style/SettingsSectionCard.First"
        android:orientation="vertical">

        <TextView
          style="@style/SettingsSectionCardTitle"
          android:text="@string/section_post_process_scope" />

        <com.google.android.material.materialswitch.MaterialSwitch
          android:id="@+id/switchPostProcessEnabled"
          style="@style/SettingsSwitch"
          android:layout_marginTop="0dp"
          android:text="@string/label_ai_post_process_enabled" />

        <com.google.android.material.materialswitch.MaterialSwitch
          android:id="@+id/switchAiEditPreferLastAsr"
          style="@style/SettingsSwitch"
          android:layout_marginTop="0dp"
          android:text="@string/label_ai_edit_default_use_last_asr" />

        <TextView
          style="@style/SettingsSectionTitle"
          android:text="@string/title_ai_skip_under" />

        <com.google.android.material.textfield.TextInputLayout
          style="@style/SettingsTextInputLayout"
          android:hint="@string/label_ai_skip_under_chars"
          app:helperText="@string/helper_ai_skip_under_chars">

          <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/etSkipAiUnderChars"
            style="@style/SettingsTextInput"
            android:inputType="number"
            android:maxLength="4" />
        </com.google.android.material.textfield.TextInputLayout>
      </LinearLayout>

      <!-- Group 2: 后处理模型 (LLM 配置：供应商选择 + 内置/自定义) -->
      <LinearLayout
        style="@style/SettingsSectionCard"
        android:orientation="vertical">

        <TextView
          style="@style/SettingsSectionCardTitle"
          android:text="@string/section_post_process_model" />

        <!-- LLM 供应商选择 -->
        <TextView
          style="@style/SettingsSectionTitle"
          android:layout_marginTop="0dp"
          android:text="@string/label_llm_vendor" />

        <TextView
          android:id="@+id/tvLlmVendor"
          style="@style/SettingsClickableValue.Dropdown" />

        <!-- ========== SiliconFlow 配置区域 ========== -->
        <LinearLayout
          android:id="@+id/groupSfFreeLlm"
          android:layout_width="match_parent"
          android:layout_height="wrap_content"
          android:orientation="vertical"
          android:visibility="gone">

          <!-- 免费/付费切换 -->
          <com.google.android.material.materialswitch.MaterialSwitch
            android:id="@+id/switchSfUseFreeService"
            style="@style/SettingsSwitch"
            android:layout_marginTop="0dp"
            android:text="@string/label_sf_use_free_service" />

          <!-- 免费服务说明 (仅免费模式可见) -->
          <TextView
            android:id="@+id/tvSfFreeServiceDesc"
            style="@style/SettingsHint"
            android:text="@string/sf_free_service_desc" />

          <!-- 付费模式 API Key 输入 (仅付费模式可见) -->
          <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/tilSfApiKey"
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_llm_api_key"
            android:visibility="gone">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etSfApiKey"
              style="@style/SettingsTextInput"
              android:inputType="textPassword" />
          </com.google.android.material.textfield.TextInputLayout>

          <TextView
            android:id="@+id/tvSfFreeLlmModel"
            style="@style/SettingsClickableValue.Dropdown" />

          <!-- 自定义模型ID输入 (选中自定义模型时可见) -->
          <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/tilSfCustomModelId"
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_custom_model_id"
            android:visibility="gone">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etSfCustomModelId"
              style="@style/SettingsTextInput"
              android:inputType="text" />
          </com.google.android.material.textfield.TextInputLayout>

          <!-- 推理模式开关 (仅支持的模型显示) -->
          <LinearLayout
            android:id="@+id/layoutSfReasoningMode"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:visibility="gone">

            <com.google.android.material.materialswitch.MaterialSwitch
              android:id="@+id/switchSfReasoningMode"
              style="@style/SettingsSwitch"
              android:layout_marginTop="0dp"
              android:text="@string/label_reasoning_mode" />

            <TextView
              android:id="@+id/tvSfReasoningModeHint"
              style="@style/SettingsHint"
              android:text="@string/hint_reasoning_mode" />
          </LinearLayout>

          <!-- Temperature 输入（付费模式可见） -->
          <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/tilSfTemperature"
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_llm_temperature"
            android:visibility="gone">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etSfTemperature"
              style="@style/SettingsTextInput"
              android:inputType="numberDecimal" />
          </com.google.android.material.textfield.TextInputLayout>

          <!-- Powered by SiliconFlow Logo -->
          <ImageView
            android:id="@+id/imgSfFreeLlmPoweredBy"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:adjustViewBounds="true"
            android:scaleType="fitCenter"
            android:src="@drawable/powered_by_siliconflow_light"
            android:contentDescription="@string/sf_powered_by_desc" />

          <!-- Register SiliconFlow account prompt -->
          <TextView
            style="@style/SettingsHint"
            android:layout_marginTop="12dp"
            android:text="@string/sf_free_register_hint" />

          <LinearLayout
            style="@style/SettingsButtonRow"
            android:layout_marginTop="8dp">

            <com.google.android.material.button.MaterialButton
              android:id="@+id/btnSfFreeLlmRegister"
              style="@style/SettingsRowButtonLeft"
              android:text="@string/btn_get_api_key" />

            <com.google.android.material.button.MaterialButton
              android:id="@+id/btnSfFreeLlmTestCall"
              style="@style/SettingsRowButtonRight"
              android:text="@string/btn_llm_test_call" />
          </LinearLayout>
        </LinearLayout>

        <!-- ========== 内置供应商配置区域 ========== -->
        <LinearLayout
          android:id="@+id/groupBuiltinLlm"
          android:layout_width="match_parent"
          android:layout_height="wrap_content"
          android:orientation="vertical"
          android:visibility="gone">

          <!-- API Key 输入 -->
          <com.google.android.material.textfield.TextInputLayout
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_llm_api_key">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etBuiltinApiKey"
              style="@style/SettingsTextInput"
              android:inputType="textPassword" />
          </com.google.android.material.textfield.TextInputLayout>

          <TextView
            android:id="@+id/tvBuiltinModel"
            style="@style/SettingsClickableValue.Dropdown" />

          <!-- 自定义模型ID输入 (选中自定义时可见) -->
          <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/tilBuiltinCustomModelId"
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_custom_model_id"
            android:visibility="gone">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etBuiltinCustomModelId"
              style="@style/SettingsTextInput"
              android:inputType="text" />
          </com.google.android.material.textfield.TextInputLayout>

          <!-- 推理模式开关 (仅支持的模型显示) -->
          <LinearLayout
            android:id="@+id/layoutBuiltinReasoningMode"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:visibility="gone">

            <com.google.android.material.materialswitch.MaterialSwitch
              android:id="@+id/switchBuiltinReasoningMode"
              style="@style/SettingsSwitch"
              android:layout_marginTop="0dp"
              android:text="@string/label_reasoning_mode" />

            <TextView
              android:id="@+id/tvBuiltinReasoningModeHint"
              style="@style/SettingsHint"
              android:text="@string/hint_reasoning_mode" />
          </LinearLayout>

          <!-- Temperature 输入 -->
          <com.google.android.material.textfield.TextInputLayout
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_llm_temperature">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etBuiltinTemperature"
              style="@style/SettingsTextInput"
              android:inputType="numberDecimal" />
          </com.google.android.material.textfield.TextInputLayout>

          <!-- 按钮行：获取Key + 测试调用 -->
          <LinearLayout
            style="@style/SettingsButtonRow"
            android:layout_marginTop="8dp">

            <com.google.android.material.button.MaterialButton
              android:id="@+id/btnBuiltinRegister"
              style="@style/SettingsRowButtonLeft"
              android:text="@string/btn_get_api_key" />

            <com.google.android.material.button.MaterialButton
              android:id="@+id/btnBuiltinTestCall"
              style="@style/SettingsRowButtonRight"
              android:text="@string/btn_llm_test_call" />
          </LinearLayout>
        </LinearLayout>

        <!-- ========== 自定义 LLM 配置区域 ========== -->
        <LinearLayout
          android:id="@+id/groupCustomLlm"
          android:layout_width="match_parent"
          android:layout_height="wrap_content"
          android:orientation="vertical"
          android:visibility="gone">

          <TextView
            style="@style/SettingsHint"
            android:text="@string/custom_llm_description" />

          <TextView
            android:id="@+id/titleCustomLlm"
            style="@style/SettingsSectionTitle"
            android:text="@string/label_llm_choose_profile" />

          <TextView
            android:id="@+id/tvLlmProfilesValue"
            style="@style/SettingsClickableValue.Dropdown"
            android:text="@string/untitled_profile" />

          <Spinner style="@style/SettingsHiddenSpinner" />

          <com.google.android.material.textfield.TextInputLayout
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_llm_profile_name">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etLlmProfileName"
              style="@style/SettingsTextInput"
              android:inputType="text" />
          </com.google.android.material.textfield.TextInputLayout>

          <LinearLayout
            style="@style/SettingsButtonRow"
            android:layout_marginTop="4dp">

            <com.google.android.material.button.MaterialButton
              android:id="@+id/btnLlmAddProfile"
              style="@style/SettingsRowButtonLeft"
              android:text="@string/btn_llm_add_profile" />

            <com.google.android.material.button.MaterialButton
              android:id="@+id/btnLlmDeleteProfile"
              style="@style/SettingsRowButtonRight"
              android:text="@string/btn_llm_delete_profile" />
          </LinearLayout>

          <com.google.android.material.textfield.TextInputLayout
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_llm_endpoint">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etLlmEndpoint"
              style="@style/SettingsTextInput"
              android:inputType="textUri" />
          </com.google.android.material.textfield.TextInputLayout>

          <com.google.android.material.textfield.TextInputLayout
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_llm_api_key">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etLlmApiKey"
              style="@style/SettingsTextInput"
              android:inputType="textPassword" />
          </com.google.android.material.textfield.TextInputLayout>

          <com.google.android.material.textfield.TextInputLayout
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_llm_model">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etLlmModel"
              style="@style/SettingsTextInput"
              android:inputType="text" />
          </com.google.android.material.textfield.TextInputLayout>

          <com.google.android.material.textfield.TextInputLayout
            style="@style/SettingsTextInputLayout"
            android:hint="@string/label_llm_temperature">

            <com.google.android.material.textfield.TextInputEditText
              android:id="@+id/etLlmTemperature"
              style="@style/SettingsTextInput"
              android:inputType="numberDecimal" />
          </com.google.android.material.textfield.TextInputLayout>

          <com.google.android.material.button.MaterialButton
            android:id="@+id/btnLlmTestCall"
            style="@style/SettingsTonalButton"
            android:text="@string/btn_llm_test_call" />
        </LinearLayout>
      </LinearLayout>

      <!-- Group 3: Prompt 预设 -->
      <LinearLayout
        style="@style/SettingsSectionCard"
        android:orientation="vertical">

        <TextView
          style="@style/SettingsSectionCardTitle"
          android:text="@string/label_llm_prompt_presets" />

        <TextView
          android:id="@+id/tvPromptPresetsValue"
          style="@style/SettingsClickableValue.Dropdown"
          android:text="@string/untitled_preset" />

        <Spinner style="@style/SettingsHiddenSpinner" />

        <com.google.android.material.textfield.TextInputLayout
          style="@style/SettingsTextInputLayout"
          android:hint="@string/label_llm_prompt_title">

          <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/etLlmPromptTitle"
            style="@style/SettingsTextInput"
            android:inputType="text" />
        </com.google.android.material.textfield.TextInputLayout>

        <com.google.android.material.textfield.TextInputLayout
          style="@style/SettingsTextInputLayout"
          android:hint="@string/label_llm_prompt">

          <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/etLlmPrompt"
            style="@style/SettingsTextInput.MultiLine"
            android:overScrollMode="ifContentScrolls"
            android:scrollbars="vertical" />
        </com.google.android.material.textfield.TextInputLayout>

        <LinearLayout
          style="@style/SettingsButtonRow"
          android:layout_marginTop="8dp">

          <com.google.android.material.button.MaterialButton
            android:id="@+id/btnAddPromptPreset"
            style="@style/SettingsRowButtonLeft"
            android:text="@string/btn_add_preset" />

          <com.google.android.material.button.MaterialButton
            android:id="@+id/btnDeletePromptPreset"
            style="@style/SettingsRowButtonRight"
            android:text="@string/btn_delete_preset" />
        </LinearLayout>
      </LinearLayout>
    </LinearLayout>
  </androidx.core.widget.NestedScrollView>

</LinearLayout>
